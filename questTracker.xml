<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sunday, February 06, 2022, 9:25 AM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "SHART" generated by Plugin Wizard -->

<muclient>
<plugin
   name="SHART"
   author="Kelaire"
   id="a3dccfdae35f53f9097b662d"
   language="Lua"
   purpose="Tracks quests."
   save_state="y"
   date_written="2022-09-26 09:24:49"
   requires="5.07"
   version="1.0"
   >
   
 <description trim="n">
<![CDATA[
.----------------------------------------------------------------------------.
|                 SHaelynne Awesone (quest) Request Tracker                  |
|----------------------------------------------------------------------------|
|SHART help -- Brings up the help section. (What you are reading now)        |
|                                                                            |
|SHART show -- Start displaying the miniwindow (I mean, if you walk away?)   |
|SHART hide -- Stop displaying the miniwindow (Hide the annoying window!)    |
|SHART disable -- Stop the automatic refresh (Useful during epics)           |
|SHART enable -- Start the automatic refresh (To start it again)             |
|SHART refresh -- Manually refresh the window                                |
|                                                                            |
'----------------------------------------------------------------------------'
]]>
</description>

</plugin>

<!--  Aliases  -->

<aliases>
	<alias script="CheckQuest" match="^SHART Check$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="ShowHelp" match="^SHART( help)?$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="ShowWindow" match="^SHART show$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="HideWindow" match="^SHART hide$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="StopAuto" match="^SHART disable$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
	<alias script="StartAuto" match="^SHART enable$" enabled="y" regexp="y" sequence="100" ignore_case="y"></alias>
</aliases>

<!-- Triggers -->

<triggers>

</triggers>

<script>

<![CDATA[

require "gmcphelper"
require "themed_miniwindows"

-- Default Font Sizes
fontSize = 9
headerSize = 10

-- Initialize variables
local my_window = ThemedTextWindow("SHART", 300, 300, 421, 250, "SHART", "center", false, false, false, false, false, false, false, "Consolas", headerSize, "Consolas", fontSize, 1000, 2)
my_window:reset()

-- When we install, start the timer working and initialize the window
function OnPluginInstall()
	AddTimer("SHARTTimer", 0, 0, 15, "", timer_flag.Enabled, "CheckQuest")
	ColourNote("Green","","SHART: Installed and active!")
	CheckQuest()
	HideWindow()
end

-- Disable plugin - Hide window
function OnPluginDisable()
	HideWindow()
end

-- Check for quest
function OnPluginBroadcast(msg, id, name, text)
	-- gmcphelper plugin
	if id == '3e7dedbe37e44942dd46d264' then
		-- comm.quest {"action": "ready" }
		if text == "comm.quest" then
			-- action = "ready" or "status"
			comm_quest = gmcp("comm.quest")
			action = comm_quest.action
			if action == "ready" then
				ShowQuest()
			elseif action == "start" then
			    HideWindow()
			elseif action == "status" then
				status = comm_quest.status
				if status == "ready" then
					ShowQuest()
				end
			else
				return
			end
		end
	end
end

function ShowQuest()
	ColourNote("Red","","Quest!")
	ShowWindow()
	my_window:clear()
	my_window:add_text("@RGO QUEST                                           GO QUEST")
	my_window:add_text("@G   GO QUEST                                     GO QUEST")
	my_window:add_text("@W      GO QUEST                               GO QUEST")
	my_window:add_text("@Y         GO QUEST                         GO QUEST")
	my_window:add_text("@B            GO QUEST                   GO QUEST")
	my_window:add_text("@C               GO QUEST             GO QUEST")
	my_window:add_text("@M                  GO QUEST       GO QUEST")
	my_window:add_text("@D                     GO QUEST GO QUEST")
	my_window:add_text("@D                     GO QUEST GO QUEST")
	my_window:add_text("@M                  GO QUEST       GO QUEST")
	my_window:add_text("@C               GO QUEST             GO QUEST")
	my_window:add_text("@B            GO QUEST                   GO QUEST")
	my_window:add_text("@Y         GO QUEST                         GO QUEST")
	my_window:add_text("@W      GO QUEST                               GO QUEST")
	my_window:add_text("@G   GO QUEST                                     GO QUEST")
	my_window:add_text("@RGO QUEST                                           GO QUEST")
end

function CheckQuest()
	Send_GMCP_Packet("request quest")
end

-- Show the window
function ShowWindow()
	my_window:show()
end

-- Hide the window
function HideWindow()
	my_window:hide()
end	

-- Stop the auto timer
function StopAuto()
	EnableTimer("SHARTTimer", false)
	ColourNote("Green","","SHART: Auto-refresh Disabled")
end

-- Start the auto timer
function StartAuto()
	EnableTimer("SHARTTimer", true)
	ColourNote("Green","","SHART: Auto-refresh Enabled")
end

-- Show the helpfile
function ShowHelp()
	ColourNote("orange", "black", GetPluginInfo (GetPluginID (), 3))
end

]]>

</script>

</muclient>